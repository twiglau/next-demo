# serverCaller ä½œç”¨

- `serverCaller = createCallerFactory()(appRouter)` æ˜¯ tRPC å®˜æ–¹æä¾›çš„ä¸€ç§åœ¨æœåŠ¡ç«¯å†…éƒ¨ç›´æ¥è°ƒç”¨ API é€»è¾‘çš„æœºåˆ¶ã€‚å®ƒçš„æ ¸å¿ƒä½œç”¨æ˜¯ï¼šè®©ä½ åœ¨ä¸éœ€è¦å‘èµ· HTTP è¯·æ±‚çš„æƒ…å†µä¸‹ï¼Œåƒè°ƒç”¨æ™®é€šçš„ JavaScript å‡½æ•°ä¸€æ ·è°ƒç”¨ tRPC çš„æ¥å£ã€‚

1. æ ¸å¿ƒä½œç”¨ï¼šæœåŠ¡ç«¯â€œç›´è¿â€

   > åœ¨ä¼ ç»Ÿçš„ Web å¼€å‘ä¸­ï¼Œå¦‚æœä½ åœ¨æœåŠ¡ç«¯æƒ³ç”¨å¦ä¸€ä¸ªæ¥å£ï¼Œé€šå¸¸éœ€è¦é€šè¿‡ fetch('http://localhost/api/...') å»è°ƒç”¨è‡ªå·±ã€‚è¿™ä¼šå¸¦æ¥é¢å¤–çš„ç½‘ç»œå¼€é”€ã€HTTP è§£æå¼€é”€ä»¥åŠåºåˆ—åŒ–å¼€é”€ã€‚

   > serverCaller å…è®¸ä½ ç»•è¿‡æ‰€æœ‰ç½‘ç»œå±‚ï¼Œç›´æ¥æ‰§è¡Œåç«¯çš„ä¸šåŠ¡é€»è¾‘ï¼ˆProceduresï¼‰ï¼ŒåŒæ—¶ä¿ç•™å®Œæ•´çš„ TypeScript ç±»å‹æç¤ºã€‚

2. ä¸ºä»€ä¹ˆéœ€è¦è¿™ä¹ˆç”¨ï¼Ÿ (ç»“åˆä½ çš„ä»£ç )
   > åœ¨ä½ çš„é¡¹ç›® src/app/dashboard/apps/new/page.tsxä¸­ï¼Œå°±èƒ½çœ‹åˆ°å®ƒçš„å…¸å‹ç”¨æ³•ï¼š

```ts
// ... å…¶ä»–å¯¼å…¥
const createApp = async (formData: FormData) => {
  "use server"; // è¿™æ˜¯ä¸€ä¸ª Next.js Server Action
  // ... éªŒè¯é€»è¾‘
  const session = await getServerSession();

  // ğŸ’¡ å…³é”®ç‚¹ï¼š
  const newApp = await serverCaller({ session }).apps.createApp(input.data);

  redirect(`/dashboard/apps/${newApp.id}`);
};
```

## ç†ç”±å¦‚ä¸‹ï¼š

1. Server Actions / Server Componentsï¼š åœ¨ Next.js çš„æœåŠ¡ç«¯ç»„ä»¶æˆ–æœåŠ¡ç«¯åŠ¨ä½œï¼ˆServer Actionsï¼‰ä¸­ï¼Œä½ å·²ç»åœ¨æœåŠ¡å™¨ä¸Šäº†ã€‚æ­¤æ—¶æ²¡å¿…è¦å»è¯·æ±‚ /api/trpc/...ï¼Œç›´æ¥è°ƒç”¨å‡½æ•°æœ€å¿«ã€‚
2. æ‰‹åŠ¨æ³¨å…¥ Contextï¼š tRPC æ¥å£é€šå¸¸éœ€è¦é‰´æƒï¼ˆSessionï¼‰ã€‚serverCaller å…è®¸ä½ æ‰‹åŠ¨ä¼ å…¥ä¸€ä¸ª { session } å¯¹è±¡ä½œä¸º Contextï¼Œè¿™æ · tRPC çš„ä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰å°±èƒ½æ­£å¸¸è·å–åˆ°ç”¨æˆ·ä¿¡æ¯å¹¶è¿›è¡Œæƒé™æ ¡éªŒã€‚
3. é«˜æ€§èƒ½ï¼š å®ƒå®Œå…¨æ˜¯æœ¬åœ°å‡½æ•°è°ƒç”¨ï¼Œæ€§èƒ½æé«˜ã€‚
4. ä»£ç å¤ç”¨ï¼š ä½ ä¸éœ€è¦æŠŠåˆ›å»ºé€»è¾‘å†™ä¸¤éï¼ˆä¸€éå†™åœ¨ tRPC é‡Œï¼Œä¸€éå†™åœ¨ Server Action é‡Œï¼‰ï¼Œåªéœ€è¦ç»´æŠ¤ä¸€å¥— tRPC å®šä¹‰ï¼Œç„¶ååœ¨ä»»ä½•åœ°æ–¹ï¼ˆå‰ç«¯ Hookã€åç«¯ Actionã€å•å…ƒæµ‹è¯•ï¼‰å¤ç”¨ã€‚

## æ€»ç»“

- å®¢æˆ·ç«¯ (Browser)ï¼š ä½¿ç”¨ trpcClientReact.xxxx.useQuery() (èµ° HTTP è¯·æ±‚)ã€‚
- æœåŠ¡ç«¯ (Server)ï¼š ä½¿ç”¨ serverCaller({ session }).xxxx() (ç›´æ¥å‡½æ•°è°ƒç”¨)ã€‚
